{% extends "private/base.html" %}
{% load static %}

{% block title %}Taco - Share and find{% endblock %}
{% block content %}

<div class="container">

    {% if following_list %}
    <div class="row">
        {% for following in following_list %}
        <div class="col-lg-6 offset-lg-3">
            <a href="#">
                <div class="cardbox shadow-lg bg-white">

                    <div class="cardbox-heading">
                        <!-- START dropdown-->
                        <div class="dropdown float-right">
                            <button class="btn btn-flat btn-flat-icon" type="button" data-toggle="dropdown"
                                aria-expanded="false">
                                <em class="fa fa-ellipsis-h"></em>
                            </button>
                            <div class="dropdown-menu dropdown-scale dropdown-menu-right" role="menu"
                                style="position: absolute; transform: translate3d(-136px, 28px, 0px); top: 0px; left: 0px; will-change: transform;">
                                <a class="dropdown-item" href="#">Hide post</a>
                                <a class="dropdown-item" href="#">Stop following</a>
                                <a class="dropdown-item" href="#">Report</a>
                            </div>
                        </div>
                        <!--/ dropdown -->
                        <div class="media m-0">
                            <div class="d-flex mr-3">
                                <a href="{% url 'private_user' following.user.id %}">
                                    {% if following.user.avatar %}
                                    <img class="img-fluid rounded-circle" src="{{ following.user.avatar.url }}" alt="User"></a>
                                    {% else %}
                                    <img class="img-fluid rounded-circle" src="{% static 'users/images/default.jpg' %}" alt="Image">
                                    {% endif %}
                            </div>
                            <div class="media-body">
                                <p class="m-0">{{following.user.get_full_name}} - {{following.id}}</p>
                                <small><span><i class="icon ion-md-pin"></i> Nairobi, Kenya - Petition {{following.id}}</span></small>
                                <small><span><i class="icon ion-md-time"></i>{{ following.creation_date|timesince }}</span></small>
                            </div>
                        </div>
                        <!--/ media -->
                    </div>
                    <!--/ cardbox-heading -->

                    <div class="cardbox-item">
                        {% if following.following_img %}
                        <img class="img-fluid" src="{{ following.user.avatar.url }}" alt="Image">
                        {% else %}
                        <img class="img-fluid" src="{% static 'users/images/default.jpg' %}" alt="Image">
                        {% endif %}
                    </div>
                    <!--/ cardbox-item -->
                    <div class="cardbox-title">
                        <span class="mb-0">{{ following.title }}</span>
                        <p class="text-muted">{{ following.description|truncatewords:25 }}</p>
                    </div>
                    <div class="cardbox-base">
                        <ul class="float-right">
                            <li><a><i class="fa fa-comments"></i></a></li>
                            <li><a><em class="mr-5"></em></a></li>
                            <li><a><i class="fa fa-share-alt"></i></a></li>
                            <li><a><em class="mr-3"></em></a></li>
                        </ul>
                        <ul>
                            <li><a><i class="fa fa-thumbs-up"></i></a></li>
                            <li><a href="#"><img
                                        src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/3.jpeg"
                                        class="img-fluid rounded-circle" alt="User"></a></li>
                            <li><a href="#"><img
                                        src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/1.jpg"
                                        class="img-fluid rounded-circle" alt="User"></a></li>
                            <li><a href="#"><img
                                        src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/5.jpg"
                                        class="img-fluid rounded-circle" alt="User"></a></li>
                            <li><a href="#"><img
                                        src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/2.jpg"
                                        class="img-fluid rounded-circle" alt="User"></a></li>
                            <li><a><span class="joined_{{ following.id }}">{{ following.num_joins }}</span> following {{following.name}}</a></li>
                        </ul>
                    </div>
                    <!--/ cardbox-like -->
                </div>
                <!--/ cardbox -->
            </a>
        </div>
        <!--/ col-lg-6 -->
        {% endfor %}
    </div>
    {% else %}
    <p>You are not following anyone, but try these...</p>
    {% endif %}

    {% if random_user_list %}
    <div class="row mt-5">
        <div class="h5 col-lg-6 offset-lg-3 text-center mt-5 mb-3 ">People you may know... (or not)</div>
        {% for random_user in random_user_list %}
        <div class="col-lg-6 offset-lg-3">
            <a href="#">
                <div class="cardbox shadow-lg bg-white">

                    <div class="cardbox-heading">
                        <!-- START dropdown-->
                        <div class="dropdown float-right">
                            <button class="btn btn-flat btn-flat-icon" type="button" data-toggle="dropdown"
                                aria-expanded="false">
                                <em class="fa fa-ellipsis-h"></em>
                            </button>
                            <div class="dropdown-menu dropdown-scale dropdown-menu-right" role="menu"
                                style="position: absolute; transform: translate3d(-136px, 28px, 0px); top: 0px; left: 0px; will-change: transform;">
                                <a class="dropdown-item" href="#">Hide post</a>
                                <a class="dropdown-item" href="#">Stop following</a>
                                <a class="dropdown-item" href="#">Report</a>
                            </div>
                        </div>
                        <!--/ dropdown -->
                        <div class="media m-0">
                            <div class="d-flex mr-3">
                                <a href="{% url 'private_user' random_user.id %}">
                                    {% if random_user.avatar %}
                                    <img class="img-fluid rounded-circle" src="{{ random_user.avatar.url }}" alt="User"></a>
                                    {% else %}
                                    <img class="img-fluid rounded-circle" src="{% static 'users/images/default.jpg' %}" alt="Image">
                                    {% endif %}
                            </div>
                            <div class="media-body">
                                <p class="m-0">{{random_user.get_full_name}} - {{random_user.id}}</p>
                                <small><span><i class="icon ion-md-pin"></i> Nairobi, Kenya - Petition </span></small>
                                <small><span><i class="icon ion-md-time"></i>{{ random_user.creation_date|timesince }}</span></small>
                            </div>
                        </div>
                        <!--/ media -->
                    </div>
                    <!--/ cardbox-heading -->

                    <div class="cardbox-item">
                        {% if random_user.avatar%}
                        <img class="img-fluid" src="{{ random_user.avatar.url }}" alt="Image">
                        {% else %}
                        <img class="img-fluid" src="{% static 'users/images/default.jpg' %}" alt="Image">
                        {% endif %}
                    </div>
                    <!--/ cardbox-item -->
                    <div class="cardbox-title">

                        <p class="text-muted">{{ random_user.description|truncatewords:25 }}</p>
                    </div>
                    <div class="cardbox-base">
                        <ul class="float-right">
                            <li><a><i class="fa fa-comments"></i></a></li>
                            <li><a><em class="mr-5"></em></a></li>
                            <li><a><i class="fa fa-share-alt"></i></a></li>
                            <li><a><em class="mr-3"></em></a></li>
                        </ul>
                        <ul>
                            <li><a><i class="fa fa-thumbs-up"></i></a></li>
                            <li><a href="#"><img
                                        src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/3.jpeg"
                                        class="img-fluid rounded-circle" alt="User"></a></li>
                            <li><a href="#"><img
                                        src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/1.jpg"
                                        class="img-fluid rounded-circle" alt="User"></a></li>
                            <li><a href="#"><img
                                        src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/5.jpg"
                                        class="img-fluid rounded-circle" alt="User"></a></li>
                            <li><a href="#"><img
                                        src="http://www.themashabrand.com/templates/bootsnipp/post/assets/img/users/2.jpg"
                                        class="img-fluid rounded-circle" alt="User"></a></li>
                            <li><a><span class="follow_{{ random_user.id }}">{{ random_user.num_joins }}</span> following {{random_user.get_full_name}} y yo {{random_user.i_joined}}</a></li>
                        </ul>
                    </div>
                    <!--/ cardbox-like -->
                    <div class="cardbox-comments">

                        <ul>
                            {% if random_user.id != user.id %}

                                <li class="follow_btn_{{ random_user.id }} btn btn-info" onclick="javascript:follow('{{ random_user.id }}')">Follow</li>

                                <li class="unfollow_btn_{{ random_user.id }} invisible btn btn-info" onclick="javascript:follow('{{ random_user.id }}')">Unfollow</li>

                            {% endif %}

                        </ul>

                        <!--/. Search -->
                    </div>
                </div>
                <!--/ cardbox -->
            </a>
        </div>
        <!--/ col-lg-6 -->
        {% endfor %}
    </div>
    {% else %}
    <p>You are not following anyone, but try these...</p>
    {% endif %}


</div>


{% endblock %}


{% block extra_js %}
<script>
    function follow(user_id) {
        $(".follow_btn_"+user_id).hide();

        $.ajax({
            
            url: '{% url "following" %}',
            data: {
                'following_to': user_id
            },
            type: "POST",
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
            },
            dataType: 'json',
            success: function (data) {
                $("span#count-follow").html(parseInt($("span#count-follow").html()) + 1)
                console.log("Enviado following");
                $(".unfollow_btn_"+user_id).removeClass("invisible");
                if (data.is_taken) {
                }
            }
        });
    }

    $('.follow').click(function () {
        follow();
        $('.follow').off();
    });

</script>
{% endblock extra_js %}